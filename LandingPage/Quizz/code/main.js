let data = [
  {
    "id": 1,
    "name": "Kỹ thuật",
    "title": "Kỹ thuật",
    "code": "realistic",
    "detail": "Nếu có đầy đủ cơ hội và nguồn lực, bạn có thích... 1",
    "quests": [
      { "quest": "Q1-1", "id": 1, "value": "-1" },
      { "quest": "Q1-2", "id": 2, "value": "-1" },
      { "quest": "Q1-3", "id": 3, "value": "-1" },
      { "quest": "Q1-4", "id": 4, "value": "-1" },
      { "quest": "Q1-5", "id": 5, "value": "-1" },
      { "quest": "Q1-6", "id": 6, "value": "-1" },
      { "quest": "Q1-7", "id": 7, "value": "-1" },
      { "quest": "Q1-8", "id": 8, "value": "-1" },
      { "quest": "Q1-9", "id": 9, "value": "-1" },
      { "quest": "Q1-10", "id": 10, "value": "-1" },
      { "quest": "Q1-11", "id": 11, "value": "-1" },
      { "quest": "Q1-12", "id": 12, "value": "-1" },
      { "quest": "Q1-13", "id": 13, "value": "-1" },
      { "quest": "Q1-14", "id": 14, "value": "-1" },
      { "quest": "Q1-15", "id": 15, "value": "-1" },
      { "quest": "Q1-16", "id": 16, "value": "-1" },
      { "quest": "Q1-17", "id": 17, "value": "-1" },
      { "quest": "Q1-18", "id": 18, "value": "-1" }
    ]
  },
  {
    "id": 2,
    "name": "Nghiên cứu",
    "title": "Nghiên cứu",
    "code": "investigative",
    "detail": "Nếu có đầy đủ cơ hội và nguồn lực, bạn có thích... 2",
    "quests": [
      { "quest": "Q2-1", "id": 1, "value": "-1" },
      { "quest": "Q2-2", "id": 2, "value": "-1" },
      { "quest": "Q2-3", "id": 3, "value": "-1" },
      { "quest": "Q2-4", "id": 4, "value": "-1" },
      { "quest": "Q2-5", "id": 5, "value": "-1" },
      { "quest": "Q2-6", "id": 6, "value": "-1" },
      { "quest": "Q2-7", "id": 7, "value": "-1" },
      { "quest": "Q2-8", "id": 8, "value": "-1" },
      { "quest": "Q2-9", "id": 9, "value": "-1" },
      { "quest": "Q2-10", "id": 10, "value": "-1" },
      { "quest": "Q2-11", "id": 11, "value": "-1" },
      { "quest": "Q2-12", "id": 12, "value": "-1" },
      { "quest": "Q2-13", "id": 13, "value": "-1" },
      { "quest": "Q2-14", "id": 14, "value": "-1" },
      { "quest": "Q2-15", "id": 15, "value": "-1" },
      { "quest": "Q2-16", "id": 16, "value": "-1" },
      { "quest": "Q2-17", "id": 17, "value": "-1" },
      { "quest": "Q2-18", "id": 18, "value": "-1" }
    ]
  },
  {
    "id": 3,
    "name": "Nghệ thuật",
    "title": "Nghệ thuật",
    "code": "artistic",
    "detail": "Nếu có đầy đủ cơ hội và nguồn lực, bạn có thích... 3",
    "quests": [
      { "quest": "Q3-1", "id": 1, "value": "-1" },
      { "quest": "Q3-2", "id": 2, "value": "-1" },
      { "quest": "Q3-3", "id": 3, "value": "-1" },
      { "quest": "Q3-4", "id": 4, "value": "-1" },
      { "quest": "Q3-5", "id": 5, "value": "-1" },
      { "quest": "Q3-6", "id": 6, "value": "-1" },
      { "quest": "Q3-7", "id": 7, "value": "-1" },
      { "quest": "Q3-8", "id": 8, "value": "-1" },
      { "quest": "Q3-9", "id": 9, "value": "-1" },
      { "quest": "Q3-10", "id": 10, "value": "-1" },
      { "quest": "Q3-11", "id": 11, "value": "-1" },
      { "quest": "Q3-12", "id": 12, "value": "-1" },
      { "quest": "Q3-13", "id": 13, "value": "-1" },
      { "quest": "Q3-14", "id": 14, "value": "-1" },
      { "quest": "Q3-15", "id": 15, "value": "-1" },
      { "quest": "Q3-16", "id": 16, "value": "-1" },
      { "quest": "Q3-17", "id": 17, "value": "-1" },
      { "quest": "Q3-18", "id": 18, "value": "-1" }
    ]
  },
  {
    "id": 4,
    "name": "Xã hội",
    "title": "Xã hội",
    "code": "social",
    "detail": "Nếu có đầy đủ cơ hội và nguồn lực, bạn có thích... 4",
    "quests": [
      { "quest": "Q4-1", "id": 1, "value": "-1" },
      { "quest": "Q4-2", "id": 2, "value": "-1" },
      { "quest": "Q4-3", "id": 3, "value": "-1" },
      { "quest": "Q4-4", "id": 4, "value": "-1" },
      { "quest": "Q4-5", "id": 5, "value": "-1" },
      { "quest": "Q4-6", "id": 6, "value": "-1" },
      { "quest": "Q4-7", "id": 7, "value": "-1" },
      { "quest": "Q4-8", "id": 8, "value": "-1" },
      { "quest": "Q4-9", "id": 9, "value": "-1" },
      { "quest": "Q4-10", "id": 10, "value": "-1" },
      { "quest": "Q4-11", "id": 11, "value": "-1" },
      { "quest": "Q4-12", "id": 12, "value": "-1" },
      { "quest": "Q4-13", "id": 13, "value": "-1" },
      { "quest": "Q4-14", "id": 14, "value": "-1" },
      { "quest": "Q4-15", "id": 15, "value": "-1" },
      { "quest": "Q4-16", "id": 16, "value": "-1" },
      { "quest": "Q4-17", "id": 17, "value": "-1" },
      { "quest": "Q4-18", "id": 18, "value": "-1" }
    ]
  },
  {
    "id": 5,
    "name": "Quản lý",
    "title": "Quản lý",
    "code": "enterprising",
    "detail": "Nếu có đầy đủ cơ hội và nguồn lực, bạn có thích... 5",
    "quests": [
      { "quest": "Q5-1", "id": 1, "value": "-1" },
      { "quest": "Q5-2", "id": 2, "value": "-1" },
      { "quest": "Q5-3", "id": 3, "value": "-1" },
      { "quest": "Q5-4", "id": 4, "value": "-1" },
      { "quest": "Q5-5", "id": 5, "value": "-1" },
      { "quest": "Q5-6", "id": 6, "value": "-1" },
      { "quest": "Q5-7", "id": 7, "value": "-1" },
      { "quest": "Q5-8", "id": 8, "value": "-1" },
      { "quest": "Q5-9", "id": 9, "value": "-1" },
      { "quest": "Q5-10", "id": 10, "value": "-1" },
      { "quest": "Q5-11", "id": 11, "value": "-1" },
      { "quest": "Q5-12", "id": 12, "value": "-1" },
      { "quest": "Q5-13", "id": 13, "value": "-1" },
      { "quest": "Q5-14", "id": 14, "value": "-1" },
      { "quest": "Q5-15", "id": 15, "value": "-1" },
      { "quest": "Q5-16", "id": 16, "value": "-1" },
      { "quest": "Q5-17", "id": 17, "value": "-1" },
      { "quest": "Q5-18", "id": 18, "value": "-1" }
    ]
  },
  {
    "id": 6,
    "name": "Nghiệp vụ",
    "title": "Nghiệp vụ",
    "code": "conventional",
    "detail": "Nếu có đầy đủ cơ hội và nguồn lực, bạn có thích... 6",
    "quests": [
      { "quest": "Q6-1", "id": 1, "value": "-1" },
      { "quest": "Q6-2", "id": 2, "value": "-1" },
      { "quest": "Q6-3", "id": 3, "value": "-1" },
      { "quest": "Q6-4", "id": 4, "value": "-1" },
      { "quest": "Q6-5", "id": 5, "value": "-1" },
      { "quest": "Q6-6", "id": 6, "value": "-1" },
      { "quest": "Q6-7", "id": 7, "value": "-1" },
      { "quest": "Q6-8", "id": 8, "value": "-1" },
      { "quest": "Q6-9", "id": 9, "value": "-1" },
      { "quest": "Q6-10", "id": 10, "value": "-1" },
      { "quest": "Q6-11", "id": 11, "value": "-1" },
      { "quest": "Q6-12", "id": 12, "value": "-1" },
      { "quest": "Q6-13", "id": 13, "value": "-1" },
      { "quest": "Q6-14", "id": 14, "value": "-1" },
      { "quest": "Q6-15", "id": 15, "value": "-1" },
      { "quest": "Q6-16", "id": 16, "value": "-1" },
      { "quest": "Q6-17", "id": 17, "value": "-1" },
      { "quest": "Q6-18", "id": 18, "value": "-1" }
    ]
  }
];
let ID_GROUP = 1;
let ID_COMPLETE = 1;
let DATA_LENGTH = data.length;

const localStorageItem = {
  quizzResult: "quizzResult",
}



// Element
const prevButton = document.querySelector("#prev-button");
const nextButton = document.querySelector("#next-button");

const elementQuest = ({
  quest,
  id,
  idGroup,
  value,
}) => {
  const content = `
  <p>${quest}</p>
  <form name="form${id}">
    <div class="true-or-false">
      <div>
        <input class="radio" type="radio" name="${id}" value="0">
      </div>
      <div>
        <input class="radio" type="radio" name="${id}" value="1">
      </div>
    </div>
  </form>
  `

  const questElement = document.createElement("div");
  questElement.className = "quest";
  questElement.innerHTML = content;

  return questElement;
}

const elementGroup = ({
  id,
  name,
}) => {
  const content =
    `
  <div class="${id === ID_GROUP ? "group-active" : ""} number">${id}</div>
  <div class="name-group">${name}</div>
  `
  const groupElement = document.createElement("div");
  groupElement.className = `${id === ID_GROUP ? "active" : ""} group`;
  groupElement.innerHTML = content;
  return groupElement;
}

const groupNavigation = () => {
  const groups = document.querySelectorAll(".group");
  groups.forEach((g) => {
    const indexGroup = Number(g.childNodes[1].innerHTML);

    if (indexGroup <= ID_COMPLETE) {
      g.addEventListener("click", () => {
        ID_GROUP = indexGroup;

        prevButton.style.display = "block";
        prevButton.innerHTML = "Trở lại";
        nextButton.innerHTML = "Tiếp tục";
        switch (ID_GROUP) {
          case 1:
            prevButton.style.display = "none";
            break;
          case DATA_LENGTH:
            nextButton.innerHTML = "Hoàn thành";
          default:
            break;
        }

        initRender();
      })
    } else {
      g.style.cursor = "no-drop";
    }

  })
}




// Render
const renderListGroup = () => {
  const listGroupElement = document.querySelector(".list-group")
  listGroupElement.innerHTML = "";
  data.forEach((d) => {
    listGroupElement.appendChild(elementGroup({ id: d.id, name: d.name }));
  })
}

const renderListQuest = () => {
  const headerQuestTitle = document.querySelector(".header .type .title");
  const headerQuestDetail = document.querySelector(".header .type .detail");
  const elementListQuest = document.querySelector(".list-quest");

  const group = data.find((d) => d.id === ID_GROUP);
  const listQuest = group.quests || [];

  headerQuestTitle.innerHTML = group.title;
  headerQuestDetail.innerHTML = group.detail;
  elementListQuest.innerHTML = "";
  listQuest.forEach((q) => {
    elementListQuest.appendChild(elementQuest({ ...q, idGroup: ID_GROUP }));
    const formQuest = document[`form${q.id}`];
    if (q.value === "0") {
      formQuest[0].checked = true;
    }
    if (q.value === "1") {
      formQuest[1].checked = true;
    }
    formQuest[0].addEventListener("click", () => {
      formQuest[0].checked = true;
      formQuest[1].checked = false;
      q.value = "0";
      group.quests = listQuest;
      data = data.map((d) => d.id === group.id ? group : d);
    })
    formQuest[1].addEventListener("click", () => {
      formQuest[0].checked = false;
      formQuest[1].checked = true;
      q.value = "1";
      group.quests = listQuest;
      data = data.map((d) => d.id === group.id ? group : d);
    })
  });
}


const initRender = () => {
  const quizzResult = JSON.parse(localStorage.getItem(localStorageItem.quizzResult));

  if(quizzResult !== null) {
    const cutPath = window.location.pathname.split("/Quizz/");
    window.location.href = `${cutPath[0]}/TestResult/${cutPath[1]}`;
    return;
  }

  renderListGroup();
  renderListQuest();
  groupNavigation();
  radioSelect();
  resizeFunc();


  // Navigation

  // Prev
  prevButton.addEventListener("click", prevFunc);


  // Next
  let checkFullQuestion = true;
  const groupQuest = data.find((d) => d.id === ID_GROUP);

  if(groupQuest !== undefined) {
    groupQuest.quests.forEach((q) => {
      checkFullQuestion = q.value === "-1" ? false : checkFullQuestion;
    })
  } else {
    checkFullQuestion = false;
  }

  if(checkFullQuestion) {
    nextButton.style.cursor = "pointer";
    nextButton.style.backgroundColor = "#0051AE";
    nextButton.style.borderColor = "#0051AE";

    if(ID_GROUP === DATA_LENGTH) {
      nextButton.removeEventListener("click", nextFunc);
      nextButton.addEventListener("click", submit);
    } else {
      nextButton.removeEventListener("click", submit);
      nextButton.addEventListener("click", nextFunc);
    }
  

  } else {
    nextButton.removeEventListener("click", nextFunc);
    nextButton.removeEventListener("click", submit);
    nextButton.style.cursor = "no-drop";
    nextButton.style.backgroundColor = "#9FA2A6";
    nextButton.style.borderColor = "#9FA2A6";
  }

  window.onresize = resizeFunc;
}




// Action
const nextFunc = () => {
  ID_GROUP = ID_GROUP < DATA_LENGTH ? ID_GROUP + 1 : DATA_LENGTH;
  ID_COMPLETE = ID_GROUP > ID_COMPLETE ? ID_GROUP : ID_COMPLETE;
  prevButton.style.display = "block";
  if (ID_GROUP === DATA_LENGTH) {
    nextButton.innerHTML = "Hoàn thành";
  } else {
    nextButton.innerHTML = "Tiếp tục";
  }
  initRender();
}

const prevFunc = () => {
  ID_GROUP = ID_GROUP > 1 ? ID_GROUP - 1 : 1;
  nextButton.innerHTML = "Tiếp tục";
  if (ID_GROUP === 1) {
    prevButton.style.display = "none";
  } else {
    prevButton.style.display = "block";
  }
  initRender();
}

const resizeFunc = () => {
  const numberGroup = document.querySelector(".active.group .number");
  if(window.innerWidth < 576) {
    numberGroup.innerHTML = `Phần ${ID_GROUP}/${DATA_LENGTH}: `;
  } else {
    numberGroup.innerHTML = `${ID_GROUP}`;
  }
}

const submit = () => {
  const pointGroup = data.map((d) => {
    const point = d.quests.reduce((prev, cur) => prev = prev + (cur.value === "1" ? 1 : 0), 0);
    return {
      id: d.id,
      name: d.name,
      detail: d.detail,
      point,
      code: d.code,
      maxPoint: d.quests.length,
    }
  });
  const dataSaveCookie = {};
  pointGroup.forEach((p) => {
    const obj = {
      point: p.point,
      maxPoint: p.maxPoint
    }
    dataSaveCookie[`${p.code}`] = obj;
  });
  localStorage.removeItem(localStorageItem.quizzResult);
  localStorage.setItem(localStorageItem.quizzResult, JSON.stringify(dataSaveCookie));
  const cutPath = window.location.pathname.split("/Quizz/");
  window.location.href = `${cutPath[0]}/TestResult/${cutPath[1]}`;
}

const radioSelect = () => {
  const radio = document.querySelectorAll(".radio");
  radio.forEach((r) => {
    r.addEventListener("click", initRender);
  })
}


// init
prevButton.style.display = "none";
initRender();